{% include 'admin-layout.html' %}

<!-- Begin Page Content -->
<div class="container-fluid">

  <!-- Page Heading -->
  <h1 class="h3 mb-2 text-gray-800">Doanh thu tính theo ngày</h1>
  <p class="mb-4">Chart.js is a third party plugin that is used to generate the charts in this theme. The charts below
    have been customized - for further customization options, please visit the <a target="_blank"
      href="https://www.chartjs.org/docs/latest/">official Chart.js documentation</a>.</p>

  <!-- Content Row -->
  <div class="row">

    <div class="col-xl-12 col-lg-12">

      <!-- Area Chart -->
      <!-- <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h5 class="m-0 font-weight-bold text-primary">Thống kê doanh thu</h5>
          <h6>(Biểu đồ miền)</h6>
        </div>
        <div class="card-body">
          <div class="chart-area">w
            <canvas id="AreaChartDate"></canvas>
            <script>
              var ctx = document.getElementById("AreaChartDate");
              var LineChart = new Chart(ctx, {
                type: 'line',
                data: {
                  labels:
                    [{% for item in date_index %}   
                            '{{ item|safe }}',
                          {% endfor %}],
              datasets: [{
                label: "Doanh thu",
                lineTension: 0.3,
                backgroundColor: "rgba(78, 115, 223, 0.05)",
                borderColor: "rgba(78, 115, 223, 1)",
                pointRadius: 3,
                pointBackgroundColor: "rgba(78, 115, 223, 1)",
                pointBorderColor: "rgba(78, 115, 223, 1)",
                pointHoverRadius: 3,
                pointHoverBackgroundColor: "rgba(78, 115, 223, 1)",
                pointHoverBorderColor: "rgba(78, 115, 223, 1)",
                pointHitRadius: 10,
                pointBorderWidth: 2,
                data:
                  [{% for item in date_data %}   
                              '{{ item|safe }}',
              {% endfor %}],
                          }],
                        },
              options: {
                maintainAspectRatio: false,
                  layout: {
                  padding: {
                    left: 10,
                      right: 25,
                        top: 25,
                          bottom: 0
                  }
                },
                scales: {
                  xAxes: [{
                    time: {
                      unit: 'date'
                    },
                    gridLines: {
                      display: false,
                      drawBorder: false
                    },
                    ticks: {
                      maxTicksLimit: 7
                    }
                  }],
                    yAxes: [{
                      ticks: {
                        maxTicksLimit: 5,
                        padding: 10,
                        // Include a dollar sign in the ticks
                        callback: function (value, index, values) {
                          return '$' + number_format(value);
                        }
                      },
                      gridLines: {
                        color: "rgb(234, 236, 244)",
                        zeroLineColor: "rgb(234, 236, 244)",
                        drawBorder: false,
                        borderDash: [2],
                        zeroLineBorderDash: [2]
                      }
                    }],
                          },
                legend: {
                  display: false
                },
                tooltips: {
                  backgroundColor: "rgb(255,255,255)",
                    bodyFontColor: "#858796",
                      titleMarginBottom: 10,
                        titleFontColor: '#6e707e',
                          titleFontSize: 14,
                            borderColor: '#dddfeb',
                              borderWidth: 1,
                                xPadding: 15,
                                  yPadding: 15,
                                    displayColors: false,
                                      intersect: false,
                                        mode: 'index',
                                          caretPadding: 10,
                                            callbacks: {
                    label: function (tooltipItem, chart) {
                      var datasetLabel = chart.datasets[tooltipItem.datasetIndex].label || '';
                      return datasetLabel + ': $' + number_format(tooltipItem.yLabel);
                    }
                  }
                }
              }
                      });
            </script>
          </div>
          <hr>
          Biểu đồ thống kê doanh thu qua các ngày.
        </div>
      </div> -->

      <!-- <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h5 class="m-0 font-weight-bold text-primary">Biểu đồ cột</h5>
        </div>
        <div class="card-body">
          <div class="chart-bar">
            <canvas id="BarChartDate"></canvas>
            <script>
              function number_format(number, decimals, dec_point, thousands_sep) {
                // *     example: number_format(1234.56, 2, ',', ' ');
                // *     return: '1 234,56'
                number = (number + '').replace(',', '').replace(' ', '');
                var n = !isFinite(+number) ? 0 : +number,
                  prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
                  sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
                  dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
                  s = '',
                  toFixedFix = function (n, prec) {
                    var k = Math.pow(10, prec);
                    return '' + Math.round(n * k) / k;
                  };
                // Fix for IE parseFloat(0.55).toFixed(0) = 0;
                s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
                if (s[0].length > 3) {
                  s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
                }
                if ((s[1] || '').length < prec) {
                  s[1] = s[1] || '';
                  s[1] += new Array(prec - s[1].length + 1).join('0');
                }
                return s.join(dec);
              }

              // Bar Chart Example
              var ctx = document.getElementById("BarChartDate");
              var myBarChart = new Chart(ctx, {
                type: 'bar',
                data: {
                  labels:
                    [{% for item in date_index %}   
                            '{{ item|safe }}',
                          {% endfor %}],
              datasets: [{
                label: "Doanh thu",
                backgroundColor: "#4e73df",
                hoverBackgroundColor: "#2e59d9",
                borderColor: "#4e73df",
                data:
                  [{% for item in date_data %}   
                              '{{ item|safe }}',
              {% endfor %}],
              }],
                },
              options: {
                maintainAspectRatio: false,
                  layout: {
                  padding: {
                    left: 10,
                      right: 25,
                        top: 25,
                          bottom: 0
                  }
                },
                scales: {
                  xAxes: [{
                    time: {
                      unit: 'month'
                    },
                    gridLines: {
                      display: false,
                      drawBorder: false
                    },
                    ticks: {
                      maxTicksLimit: 6
                    },
                    maxBarThickness: 70,
                  }],
                    yAxes: [{
                      ticks: {
                        min: 0,
                        max: 80000,
                        maxTicksLimit: 5,
                        padding: 10,
                        // Include a dollar sign in the ticks
                        callback: function (value, index, values) {
                          return '$' + number_format(value);
                        }
                      },
                      gridLines: {
                        color: "rgb(234, 236, 244)",
                        zeroLineColor: "rgb(234, 236, 244)",
                        drawBorder: false,
                        borderDash: [2],
                        zeroLineBorderDash: [2]
                      }
                    }],
                  },
                legend: {
                  display: false
                },
                tooltips: {
                  titleMarginBottom: 10,
                    titleFontColor: '#6e707e',
                      titleFontSize: 14,
                        backgroundColor: "rgb(255,255,255)",
                          bodyFontColor: "#858796",
                            borderColor: '#dddfeb',
                              borderWidth: 1,
                                xPadding: 15,
                                  yPadding: 15,
                                    displayColors: false,
                                      caretPadding: 10,
                                        callbacks: {
                    label: function (tooltipItem, chart) {
                      var datasetLabel = chart.datasets[tooltipItem.datasetIndex].label || '';
                      return datasetLabel + ': $' + number_format(tooltipItem.yLabel);
                    }
                  }
                },
              }
              });
            </script>
          </div>
          <hr>
        </div>
      </div> -->
      <!-- Predict Chart-->
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h5 class="m-0 font-weight-bold text-primary">Dự đoán doanh thu</h5>
          <h6>(Biểu đồ miền)</h6>
        </div>
        <div class="card-body">
          <form action="/totaldate" method="POST">
            <input type="number" id="num_date" name="num_date" placeholder="Nhập số ngày">
            <button type="submit" class="btn btn-primary"> Dự đoán </button>
          </form>
          <div class="chart-area">
            <canvas id="AreaChartPredictDate"></canvas>
            <script>
              var ctx = document.getElementById("AreaChartPredictDate");
              var LineChart = new Chart(ctx, {
                type: 'line',
                data: {
                  labels:
                    [{% for item in date_index %}   
                            '{{ item|safe }}',
                          {% endfor %}{% for i in pred_index %}
              '{{ i|safe }}',
                {% endfor %}],
              datasets: [{
                label: "Doanh thu",
                lineTension: 0.3,
                backgroundColor: "rgba(78, 115, 223, 0.05)",
                borderColor: "rgba(78, 115, 223, 1)",
                pointRadius: 3,
                pointBackgroundColor: "rgba(78, 115, 223, 1)",
                pointBorderColor: "rgba(78, 115, 223, 1)",
                pointHoverRadius: 3,
                pointHoverBackgroundColor: "rgba(78, 115, 223, 1)",
                pointHoverBorderColor: "rgba(78, 115, 223, 1)",
                pointHitRadius: 10,
                pointBorderWidth: 2,
                data:
                  [{% for item in date_data %}   
                              '{{ item|safe }}',
              {% endfor %}
              ],
                          },
              {
                label: "Doanh thu",
                  lineTension: 0.3,
                    backgroundColor: "rgba(255, 0, 0, 0.05)",
                      borderColor: "rgba(255, 0, 0, 1)",
                        pointRadius: 3,
                          pointBackgroundColor: "rgba(255, 0, 0, 1)",
                            pointBorderColor: "rgba(255, 0, 0, 1)",
                              pointHoverRadius: 3,
                                pointHoverBackgroundColor: "rgba(255, 0, 0, 1)",
                                  pointHoverBorderColor: "rgba(255, 0, 0, 1)",
                                    pointHitRadius: 10,
                                      pointBorderWidth: 2,
                                        data:
                [{% for item in date_data[:-1] %}
              ,
                {% endfor %}
                {{ date_data[-1]}},
              {% for i in pred_data %}
              '{{ i|safe }}',
                {% endfor %}],
                          }
                        
                        ],
                        },
              options: {
                maintainAspectRatio: false,
                  layout: {
                  padding: {
                    left: 10,
                      right: 25,
                        top: 25,
                          bottom: 0
                  }
                },
                scales: {
                  xAxes: [{
                    time: {
                      unit: 'date'
                    },
                    gridLines: {
                      display: false,
                      drawBorder: false
                    },
                    ticks: {
                      maxTicksLimit: 7
                    }
                  }],
                    yAxes: [{
                      ticks: {
                        min:500,
                        max:3500,
                        maxTicksLimit: 5,
                        padding: 10,
                        // Include a dollar sign in the ticks
                        callback: function (value, index, values) {
                          return '$' + number_format(value);
                        }
                      },
                      gridLines: {
                        color: "rgb(234, 236, 244)",
                        zeroLineColor: "rgb(234, 236, 244)",
                        drawBorder: false,
                        borderDash: [2],
                        zeroLineBorderDash: [2]
                      }
                    }],
                          },
                legend: {
                  display: false
                },
                tooltips: {
                  backgroundColor: "rgb(255,255,255)",
                    bodyFontColor: "#858796",
                      titleMarginBottom: 10,
                        titleFontColor: '#6e707e',
                          titleFontSize: 14,
                            borderColor: '#dddfeb',
                              borderWidth: 1,
                                xPadding: 15,
                                  yPadding: 15,
                                    displayColors: false,
                                      intersect: false,
                                        mode: 'index',
                                          caretPadding: 10,
                                            callbacks: {
                    label: function (tooltipItem, chart) {
                      var datasetLabel = chart.datasets[tooltipItem.datasetIndex].label || '';
                      return datasetLabel + ': $' + number_format(tooltipItem.yLabel);
                    }
                  }
                }
              }
                      });
            </script>
          </div>
          <hr>
          <p>Số ngày dự đoán: <b>{{ num }}</b></p>
          <p>Sai số dự đoán trung bình (ước tính):    <b>{{  (test_rs[3].round(3))*100}}%</b></p>
          <details>
            <summary>Chi tiết</summary>
            <br>
            <h6><b>Kiểm tra tính dừng</b></h6>
            <p>Giá trị thống kê kiểm tra ADF Statistic: {{ stationary[0].round(3) }}</p>
            <p>Giá trị p-value: {{ stationary[1].round(3) }}</p>
            <p>Mức ý nghĩa:</p>
            {% for key, value in stationary[4].items() %}
            <p>{{ key }} : {{ value }}</p>
            {% endfor%}
            {% if stationary[1] < 0.05 %} 
              <p>Kết luận: Chuỗi dữ liệu đã dừng (do p-value < 0.05).</p>
            {%else%}
              <p>Kết luận: Chuỗi dữ liệu chưa dừng (do p-value > 0.05), cần dừng hóa.</p>
            {%endif%}
            <hr>
            <h6><b>Mô hình:</b></h6>
                {{ model_date }}

                <br><br><hr>
            <h6><b>Kiểm tra độ phù hợp:</b></h6>
                <p>Sai số trung bình bình phương (MSE): {{ test_rs[0].round(3) }}</p>
                <p>Căn bậc hai sai số bình phương trung bình (RMSE): {{ test_rs[1].round(3)}}</p>
                <p>Sai số tuyệt đối trung bình (MAE): {{ test_rs[2].round(3) }}</p>
                <p>Sai số tương đối trung bình (MAPE): {{ test_rs[3].round(3) }}</p>
          </details>
        </div>
      </div>
    </div>

    <!-- Donut Chart -->
    <!-- <div class="col-xl-4 col-lg-5">
              <div class="card shadow mb-4"> -->
    <!-- Card Header - Dropdown -->
    <!-- <div class="card-header py-3">
                  <h6 class="m-0 font-weight-bold text-primary">Donut Chart</h6>
                </div> -->
    <!-- Card Body -->
    <!-- <div class="card-body">
                  <div class="chart-pie pt-4">
                    <canvas id="myPieChart"></canvas>
                  </div>
                  <hr>
                  Styling for the donut chart can be found in the <code>/js/demo/chart-pie-demo.js</code> file.
                </div>
              </div>
            </div> -->
  </div>

</div>
<!-- /.container-fluid -->

</div>
<!-- End of Main Content -->

<!-- Footer -->
<footer class="sticky-footer bg-white">
  <div class="container my-auto">
    <div class="copyright text-center my-auto">
      <span>Copyright &copy; ThinhNguyenCong 2021</span>
    </div>
  </div>
</footer>
<!-- End of Footer -->

</div>
<!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
  <i class="fas fa-angle-up"></i>
</a>

<!-- Bootstrap core JavaScript-->
<script src="static/vendor/jquery/jquery.min.js"></script>
<script src="static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Core plugin JavaScript-->
<script src="static/vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Custom scripts for all pages-->
<script src="static/js/sb-admin-2.min.js"></script>

<!-- Page level plugins -->
<script src="static/vendor/chart.js/Chart.min.js"></script>

<!-- Page level custom scripts -->
<script src="static/js/demo/chart-area-demo.js"></script>
<script src="static/js/demo/chart-pie-demo.js"></script>
<script src="static/js/demo/chart-bar-demo.js"></script>

</body>

</html>